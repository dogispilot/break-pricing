<!DOCTYPE html>
<html>
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PL5RQPB0MT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-PL5RQPB0MT');
    </script>
    <meta charset="UTF-8" />
    <title>SkunkSniper.com</title>
    <link rel="icon" type="image/png" href="/resources/skunk.png" />
    <!-- Import Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap"
      rel="stylesheet"
    />
    <style>
      @font-face {
        font-family: 'BreakPricingFont';
        src: url('fonts/breakpricingfont.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
      }
      @font-face {
        font-family: 'BreakPricingFontBold';
        src: url('fonts/breakpricingfont_bold.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
      }
      body {
        font-family: 'BreakPricingFont', sans-serif;
        background-color: #121212;
        color: #e0e0e0;
        margin: 0;
        padding: 20px;
      }
      .about-link {
        position: absolute;
        top: 20px;
        right: 20px;
        color: #e0e0e0;
        text-decoration: none;
        font-size: 1rem;
        z-index: 1000;
      }
      .about-link:hover {
        text-decoration: underline;
      }
      .container {
        position: relative;
        max-width: 900px;
        margin: 0 auto;
        background: #1e1e1e;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      }
      .header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 25px;
      }
      .header img {
        width: 60px;
        margin-bottom: 10px;
      }
      h1 {
        font-family: 'BreakPricingFontBold', sans-serif;
        font-size: 2rem;
        margin: 0;
      }
      .subtitle {
        font-size: 1.2rem;
        margin: 5px 0 0 0;
      }
      h2 {
        text-align: center;
        margin-top: 0;
      }
      #teamPricesHeader {
        font-family: 'BreakPricingFontBold', sans-serif;
        margin-top: 40px;
        text-align: center;
      }
      #breakPricingHeader {
        font-family: 'BreakPricingFontBold', sans-serif;
        margin-top: 40px;
        text-align: center;
      }
      #distributionCopy {
        margin-top: 0;
      }
      .small-copy {
        text-align: center;
        font-size: 0.9rem;
        color: #bbb;
        margin-top: 0.5rem;
      }
      form#calcForm {
        margin-bottom: 25px;
      }
      /* Only hide the form rows inside the calculation form */
      #calcForm .form-row {
        display: none;
      }
      .form-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      .form-row .form-group {
        flex: 1;
        min-width: 200px;
        display: flex;
        flex-direction: column;
      }
      .form-group.no-label {
        margin-top: 1.5em;
      }
      .small-input-row .form-group input,
      .small-input-row .form-group select {
        max-width: 100px;
      }
      /* NEW: make the breaker settings small-input row display all fields in one row */
      #breakPricingOptionsMenu .small-input-row {
        display: flex;
        flex-wrap: nowrap;
        gap: 15px;
        align-items: flex-end;
      }
      /* NEW: add extra space between rows in the breaker settings menu */
      #breakPricingOptionsMenu .form-row:first-of-type {
        margin-bottom: 20px;
      }
      .form-group label {
        margin-bottom: 0px;
        font-weight: 500;
      }
      .form-group input,
      .form-group select {
        padding: 12px 15px;
        font-size: 1rem;
        border: 1px solid #444;
        border-radius: 6px;
        background-color: #2c2c2c;
        color: #e0e0e0;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
        transition: border 0.2s, box-shadow 0.2s;
        font-family: 'BreakPricingFont', sans-serif;
      }
      .form-group input:focus,
      .form-group select:focus {
        border-color: #007bff;
        box-shadow: 0 0 5px rgba(0,123,255,0.5);
        outline: none;
      }
      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type="number"] {
        -moz-appearance: textfield;
      }
      .input-button-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .lookup-button {
        padding: 12px 20px;
        font-size: 1rem;
        border: 1px solid #888;
        border-radius: 6px;
        background: transparent;
        color: #fff;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: transform 0.2s, box-shadow 0.2s;
        font-family: 'BreakPricingFont', sans-serif;
      }
      .lookup-button.small {
        padding: 8px 12px;
        font-size: 0.9rem;
      }
      .lookup-button img {
        width: 24px;
        height: 24px;
        border-radius: 50%;
      }
      .lookup-button.small img {
        width: 20px;
        height: 20px;
      }
      .steelcity-button {
        border: 1px solid #888;
        color: #fff;
        background: transparent;
      }
      .steelcity-button:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      }
      #keyPlayersSection {
        margin-top: 30px;
        padding: 15px;
        background: #2c2c2c;
        border-radius: 8px;
      }
      #keyPlayersSection h2 {
        font-family: 'BreakPricingFontBold', sans-serif;
        text-align: center;
      }
      .key-player-tiles-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 5px 30px;
        justify-items: center;
      }
      .key-player-tile {
        background: #1e1e1e;
        padding: 10px;
        margin: 10px 0;
        border-radius: 8px;
        display: flex;
        align-items: center;
        box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      }
      .key-player-tile img.team-logo {
        width: 67.5px;
        height: 67.5px;
        margin-right: 0;
        border-radius: 50%;
        opacity: 0.75;
        vertical-align: middle;
        position: relative;
      }
      .key-player-tile img.player-img {
        width: 75px;
        height: 75px;
        border-radius: 50%;
        object-fit: cover;
        margin-left: -20px;
        vertical-align: middle;
        position: relative;
        z-index: 1;
      }
      .key-player-info {
        display: flex;
        flex-direction: column;
      }
      .key-player-info strong {
        font-size: 1.1rem;
        margin-bottom: 4px;
      }
      .key-player-notes {
        font-size: 0.9rem;
        color: #bbb;
      }
      .chart-summary-container {
        display: flex;
        gap: 20px;
        margin: 30px 0;
        align-items: flex-start;
      }
      #chartContainer {
        flex: 2;
        height: 300px;
        background: #2c2c2c;
        padding: 15px;
        border-radius: 8px;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
        position: relative;
      }
      #pieChartMessage {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-size: 1.2rem;
      }
      .summary-container {
        flex: 1;
        max-width: 300px;
        display: flex;
        flex-direction: column;
        height: 300px;
      }
      .summary-container .summary-box {
        flex: 1;
        margin: 5px 0;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        font-size: 1.3rem;
        font-weight: 500;
        position: relative;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      }
      .summary-box .amount {
        font-weight: 900;
        font-size: 2rem;
      }
      #totalProfitBox {
        border: 4px solid #2e7d32;
        color: #2e7d32;
        background-color: transparent;
      }
      #whatnotsCutBox {
        border: 4px solid #bfa600;
        color: #bfa600;
        background-color: transparent;
      }
      #costOfBusinessBox {
        border: 4px solid #007bff;
        color: #007bff;
        background-color: transparent;
      }
      .toast {
        margin-top: 8px;
        padding: 8px;
        background: rgba(0,0,0,0.7);
        border-radius: 4px;
        font-size: 0.85rem;
        display: none;
        width: 100%;
        text-align: left;
      }
      .detail-box {
        background: #1e1e1e;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        font-size: 1.3rem;
        font-weight: 500;
        position: relative;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      }
      .detail-box .detail-value {
        font-size: 1.8rem;
        font-weight: 900;
        margin-bottom: 5px;
        color: #e0e0e0;
      }
      .detail-box .detail-label {
        font-size: 0.8rem;
        color: #bbb;
      }
      .setDetails-grid-4col {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: auto auto;
        gap: 20px;
        margin-bottom: 20px;
      }
      .highlight-tile .detail-value {
        font-size: 2.5rem;
        font-weight: 900;
      }
      .link-icon {
        width: 16px;
        height: 16px;
        margin-left: 4px;
        vertical-align: middle;
      }
      .ebay-icon {
        height: 16px;
        width: auto;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th, td {
        padding: 12px 15px;
        border: 1px solid #333;
        text-align: left;
      }
      th {
        background-color: #007bff;
        color: #fff;
        cursor: pointer;
        user-select: none;
      }
      th:hover {
        background-color: #0056b3;
      }
      tr:nth-child(even) {
        background-color: #2c2c2c;
      }
      tr.highlight {
        background-color: rgba(255,222,12,0.2);
      }
      img.logo {
        width: 30px;
        height: 30px;
        margin-right: 8px;
        border-radius: 50%;
      }
      #resultsTable, #fullResultsTable {
      }
      #resultsTable th:first-child,
      #resultsTable td:first-child,
      #fullResultsTable th:first-child,
      #fullResultsTable td:first-child {
        white-space: nowrap;
      }
      #fullResults {
        clear: both;
        margin-top: 20px;
      }
      @media (max-width: 600px) {
        .chart-summary-container {
          flex-direction: column;
        }
        #chartContainer, .summary-container {
          width: 100%;
          height: auto;
        }
        .summary-container .summary-box {
          margin: 10px 0;
        }
        .setDetails-grid-4col {
          grid-template-columns: 1fr !important;
        }
      }
      .glow-outofthebox:hover {
        box-shadow: 0 0 8px #f70000, 0 0 16px #f70000;
      }
      .glow-blowout:hover {
        box-shadow: 0 0 8px #9a0e20, 0 0 16px #9a0e20;
      }
      .glow-tcdb:hover {
        box-shadow: 0 0 8px #c84c19, 0 0 16px #c84c19;
      }
      .glow-daveadams:hover {
        box-shadow: 0 0 8px #27465a, 0 0 16px #27465a;
      }
      .glow-steelcity:hover {
        box-shadow: 0 0 8px #e2d61e, 0 0 16px #e2d61e;
      }
      .glow-midwestcards:hover {
        box-shadow: 0 0 8px #e8b144, 0 0 16px #e8b144;
      }
      .glow-hockeychecklists:hover {
        box-shadow: 0 0 8px #021e9b, 0 0 16px #021e9b;
      }
      .pill-button {
        display: inline-block;
        padding: 4px 12px;
        border: 1px solid #fff;
        border-radius: 999px;
        color: #fff;
        text-decoration: none;
        font-size: 0.9rem;
        cursor: pointer;
        font-family: 'BreakPricingFont', sans-serif;
      }
      .ebay-btn, .nhl-btn {
        background: none !important;
        padding: 0 !important;
        border: none !important;
        display: inline !important;
        text-decoration: none !important;
      }
      .ebay-btn img, .nhl-btn img {
        height: 16px !important;
        width: auto !important;
        box-shadow: none !important;
      }
      #selectionSentence {
        text-align: center;
        font-size: 1.8rem;
        margin-bottom: 20px;
      }
      .dropdown-container {
        display: inline-block;
        position: relative;
        cursor: pointer;
      }
      .dropdown-label {
        text-decoration: underline;
        font-weight: 900;
        font-size: 2rem;
        color: #FFEE00;
      }
      .dropdown-menu {
        display: none;
        position: absolute;
        background-color: #2c2c2c;
        min-width: 160px;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        margin-top: 6px;
        z-index: 9999;
        padding: 0;
        list-style: none;
      }
      .dropdown-menu.open {
        display: block;
      }
      .dropdown-menu li {
        padding: 8px 12px;
        white-space: nowrap;
      }
      .dropdown-menu li:hover {
        background-color: #444;
      }
      .dropdown-menu li {
        text-decoration: none;
        color: #fff;
        cursor: pointer;
      }
      .open-menu {
        display: block !important;
      }
      #priceSettingsDuplicate, #breakPricingOptionsMenu {
        display: none;
      }
      .toggle-container {
        display: inline-flex;
        align-items: center;
        margin-left: 10px;
        padding: 8px 0;
      }
      .toggle-container span {
        display: inline-block;
        vertical-align: middle;
        line-height: 28px;
        font-size: 1rem;
      }
      .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 28px;
      }
      .switch input { 
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #007bff;
        transition: .4s;
        border-radius: 28px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 24px;
        width: 24px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: #28a745;
      }
      input:checked + .slider:before {
        transform: translateX(22px);
      }
      .empty-state {
        border: 1px solid #444;
        padding: 20px;
        background-color: #2c2c2c;
        text-align: center;
        font-size: 1.2rem;
        border-radius: 8px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <a href="howitworks.html" class="about-link" style="right: 70px;">How it Works</a>
      <a href="about.html" class="about-link" style="right: 20px;">About</a>
      <div class="header">
        <img src="resources/skunk.png" alt="SkunkSniper Logo" />
        <h1>SkunkSniper.com</h1>
        <p class="subtitle">Sniff out the best breaks.</p>
      </div>

      <!-- =================== NEW SENTENCE + DROPDOWNS =================== -->
      <div id="selectionSentence">
        I want to explore 
        <span class="dropdown-container">
          <span class="dropdown-label" id="selectedSetLabel">--Select a Set--</span>
          <ul class="dropdown-menu" id="setDropdownMenu"></ul>
        </span>
        for the years
        <span class="dropdown-container">
          <span class="dropdown-label" id="selectedYearLabel">--Select a Year--</span>
          <ul class="dropdown-menu" id="yearDropdownMenu"></ul>
        </span>.
      </div>
      <!-- =============================================================== -->

      <!-- Calculation Form (Hidden selects remain for existing logic) -->
      <form id="calcForm">
        <div class="form-row">
          <div class="form-group">
            <label for="yearSelect">Select Year</label>
            <select id="yearSelect" required>
              <option value="">--Select a Year--</option>
            </select>
          </div>
          <div class="form-group">
            <label for="setSelect">Select a Set</label>
            <select id="setSelect" required>
              <option value="">--Select Set--</option>
            </select>
          </div>
          <div class="form-group no-label">
            <button type="button" class="lookup-button small glow-tcdb" onclick="openTcdbSearch()" style="padding: 8px 12px; justify-content: center;">
              <img src="resources/tcdb.jpg" alt="TCDB Logo" />
              TCDB
            </button>
          </div>
          <div class="form-group no-label">
            <button type="button" class="lookup-button small glow-hockeychecklists" onclick="openHockeyChecklistsSearch()" style="justify-content: center;">
              <img src="resources/hockeychecklists.png" alt="Hockey Checklists Icon" />
              HockeyChecklists.com
            </button>
          </div>
        </div>
      </form>

      <!-- Set Details Container (Updated to mimic Key Rookies style) -->
      <div id="setDetailsContainer" style="margin-bottom: 20px;"></div>

      <!-- Key Rookies Section -->
      <div id="keyPlayersSection" style="display:none;">
        <h2>Key Rookies</h2>
        <div class="key-player-tiles-container" id="keyPlayerTiles"></div>
      </div>

      <!-- Distribution Section (Trimmed Table) -->
      <h2 id="teamPricesHeader">Break Sniffer</h2>
      <p class="small-copy" id="distributionCopy">
        Highlighted rows represent teams with key rookies.
        <a href="#" id="priceSettingsButton" class="pill-button" style="margin-left:10px;">Price Settings</a>
      </p>
      <!-- Price Settings Menu (Duplicate) -->
      <div id="priceSettingsDuplicate" style="margin-top:10px;">
        <div class="form-row">
          <div class="form-group">
            <label for="casePriceDup" onclick="toggleInputTooltip(this)" style="cursor: pointer;">Cost of a Case ($)</label>
            <div class="toast input-tooltip" style="display:none; max-width:300px;">
              This is the estimated cost of a case from a major online retailer. Prices may fluctuate so please verify.
            </div>
            <div class="input-button-group">
              <input type="number" id="casePriceDup" class="case-price-input" step="0.01" required placeholder="Enter price" value="1999.99" style="color:#e0e0e0;" />
              <button type="button" class="lookup-button small glow-daveadams" onclick="openSetSearch()">
                <img src="https://i.pinimg.com/280x280_RS/78/07/f6/7807f6a72b75f844ed54bc06b83c3bed.jpg" alt="Lookup Icon" />
                Dave &amp; Adams
              </button>
              <button type="button" class="lookup-button small steelcity-button glow-steelcity" onclick="openSteelCitySearch()">
                <img src="https://www.steelcitycollectibles.com/storage/img/logo-scc.svg" alt="Steel City Logo" />
                Steel City
              </button>
              <button type="button" class="lookup-button small glow-midwestcards" onclick="openMidwestCardsSearch()">
                <img src="resources/midwestcards.png" alt="Midwest Cards Logo" />
                Midwest Cards
              </button>
              <button type="button" class="lookup-button small glow-blowout" onclick="openBlowoutCardsSearch()">
                <img src="https://www.blowoutcards.com/skin/frontend/base/default/images/logo-BC-Trademark3.png" alt="Blowout Cards Logo" />
                Blowout Cards
              </button>
              <button type="button" class="lookup-button small glow-outofthebox" onclick="openOotbSearch()">
                <img src="resources/ootb.png" alt="Out of the Box Logo" />
                Out of the Box
              </button>
            </div>
          </div>
        </div>
        <div class="form-row small-input-row" style="margin-top:20px;">
          <div class="form-group">
            <label for="markupDup" onclick="toggleInputTooltip(this)" style="cursor: pointer;">Markup [% or $]</label>
            <div class="toast input-tooltip" style="display:none;">
              This is the markup a breaker applies on top of the case cost.
              In percent mode: [distributed cost] * (1 + markup/100)
              In dollar mode: [distributed cost] + (distributed markup).
            </div>
            <div style="display: flex; align-items: center;">
              <input type="text" id="markupDup" required placeholder="Enter markup" value="30" style="flex:1;" />
              <div class="toggle-container">
                <label class="switch">
                  <input type="checkbox" id="markupToggleDup">
                  <span class="slider"></span>
                </label>
                <span id="markupToggleLabelDup" style="margin-left:5px;">%</span>
              </div>
            </div>
          </div>
          <div class="form-group" style="display: none;">
            <label for="userDiscountDup" onclick="toggleInputTooltip(this)" style="cursor: pointer;">User Discount (%)</label>
            <div class="toast input-tooltip" style="display:none;">This is the expected discount a breaker might offer.</div>
            <input type="text" id="userDiscountDup" required placeholder="Enter discount" value="0%" />
          </div>
          <div class="form-group" style="display: none;">
            <label for="blendedTaxDup" onclick="toggleInputTooltip(this)" style="cursor: pointer;">Blended Tax (%)</label>
            <div class="toast input-tooltip" style="display:none;">This is the estimated tax rate that applies to transactions.</div>
            <input type="text" id="blendedTaxDup" required placeholder="Enter tax" value="5.1%" />
          </div>
          <div class="form-group" style="display: none;">
            <label for="suppliesDup" onclick="toggleInputTooltip(this)" style="cursor: pointer;">Supplies per Order ($)</label>
            <div class="toast input-tooltip" style="display:none;">This includes costs such as penny sleeves, top loaders, and mailing supplies.</div>
            <input type="number" id="suppliesDup" step="0.01" required placeholder="Enter supplies cost" value="1.00" />
          </div>
        </div>
      </div>
      
      <!-- Results Section with Empty State -->
      <div id="results">
        <div class="empty-state">
          <p>Please select a year and set to get started sniping.</p>
        </div>
      </div>

      <!-- Break Pricing Tools Header & Transparency Text -->
      <h2 id="breakPricingHeader">Breaker Tools</h2>
      <p class="small-copy" id="breakPricingCopy">
        Transparency in the break pricing process.
        <a href="javascript:void(0)" onclick="toggleBreakPricingOptions()" class="pill-button" style="margin-left:10px;">Price Settings</a>
      </p>
      <div id="breakPricingOptionsMenu" style="margin-top:10px;">
        <div class="form-row">
          <div class="form-group">
            <label for="casePrice" onclick="toggleInputTooltip(this)" style="cursor: pointer;">Cost of a Case ($)</label>
            <div class="toast input-tooltip" style="display:none; max-width:300px;">
              This is the estimated cost of a case from a major online retailer. Prices may fluctuate so please verify.
            </div>
            <div class="input-button-group">
              <input type="number" id="casePrice" class="case-price-input" step="0.01" required placeholder="Enter price" value="1999.99" />
              <button type="button" class="lookup-button small glow-daveadams" onclick="openSetSearch()">
                <img src="https://i.pinimg.com/280x280_RS/78/07/f6/7807f6a72b75f844ed54bc06b83c3bed.jpg" alt="Lookup Icon" />
                Dave &amp; Adams
              </button>
              <button type="button" class="lookup-button small steelcity-button glow-steelcity" onclick="openSteelCitySearch()">
                <img src="https://www.steelcitycollectibles.com/storage/img/logo-scc.svg" alt="Steel City Logo" />
                Steel City
              </button>
              <button type="button" class="lookup-button small glow-midwestcards" onclick="openMidwestCardsSearch()">
                <img src="resources/midwestcards.png" alt="Midwest Cards Logo" />
                Midwest Cards
              </button>
              <button type="button" class="lookup-button small glow-blowout" onclick="openBlowoutCardsSearch()">
                <img src="https://www.blowoutcards.com/skin/frontend/base/default/images/logo-BC-Trademark3.png" alt="Blowout Cards Logo" />
                Blowout Cards
              </button>
              <button type="button" class="lookup-button small glow-outofthebox" onclick="openOotbSearch()">
                <img src="resources/ootb.png" alt="Out of the Box Logo" />
                Out of the Box
              </button>
            </div>
          </div>
        </div>
        <div class="form-row small-input-row">
          <div class="form-group">
            <label for="markup" onclick="toggleInputTooltip(this)" style="cursor: pointer;">Markup [% or $]</label>
            <div class="toast input-tooltip" style="display:none;">
              This is the markup a breaker applies on top of the case cost.
              In percent mode: [distributed cost] * (1 + markup/100)
              In dollar mode: [distributed cost] + (distributed markup).
            </div>
            <div style="display: flex; align-items: center;">
              <input type="text" id="markup" required placeholder="Enter markup" value="30" style="flex:1;" />
              <div class="toggle-container">
                <label class="switch">
                  <input type="checkbox" id="markupToggle">
                  <span class="slider"></span>
                </label>
                <span id="markupToggleLabel" style="margin-left:5px;">%</span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="userDiscount" onclick="toggleInputTooltip(this)" style="cursor: pointer;">User Discount (%)</label>
            <div class="toast input-tooltip" style="display:none;">This is the expected discount a breaker might offer.</div>
            <input type="text" id="userDiscount" required placeholder="Enter discount" value="0%" />
          </div>
          <div class="form-group">
            <label for="blendedTax" onclick="toggleInputTooltip(this)" style="cursor: pointer;">Blended Tax (%)</label>
            <div class="toast input-tooltip" style="display:none;">This is the estimated tax rate that applies to transactions.</div>
            <input type="text" id="blendedTax" required placeholder="Enter tax" value="5.1%" />
          </div>
          <div class="form-group">
            <label for="supplies" onclick="toggleInputTooltip(this)" style="cursor: pointer;">Supplies per Order ($)</label>
            <div class="toast input-tooltip" style="display:none;">This includes costs such as penny sleeves, top loaders, and mailing supplies.</div>
            <input type="number" id="supplies" step="0.01" required placeholder="Enter supplies cost" value="1.00" />
          </div>
        </div>
      </div>

      <!-- Chart and Summary Boxes -->
      <div class="chart-summary-container">
        <div id="chartContainer">
          <canvas id="pieChart"></canvas>
          <div id="pieChartMessage">
            Please select a year and set to get started sniping.
          </div>
        </div>
        <div class="summary-container">
          <div id="totalProfitBox" class="summary-box">
            <div class="amount">$0.00</div>
            <div class="label">Breaker's Profit</div>
            <div class="toast">Profit is how much money a breaker will make.</div>
          </div>
          <div id="whatnotsCutBox" class="summary-box">
            <div class="amount">$0.00</div>
            <div class="label">Whatnot's Cut</div>
            <div class="toast">Whatnot's cut is 8% of the breaker’s listed price, after markup and discount.</div>
          </div>
          <div id="costOfBusinessBox" class="summary-box">
            <div class="amount">$0.00</div>
            <div class="label">Cost of Business</div>
            <div class="toast">Cost of Business includes transaction fees and additional per order supplies cost.</div>
          </div>
        </div>
      </div>

      <!-- Full Distribution Table (Full View: all columns) -->
      <div id="fullResults"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      function formatDetail(val, isRookie) {
        let num = parseFloat(val);
        if (!isNaN(num)) {
          if (isRookie) {
            let rounded = Math.floor(num * 10) / 10;
            return rounded.toFixed(1) + "%";
          } else {
            return (num % 1 === 0) ? num.toFixed(0) : num.toFixed(1);
          }
        } else {
          return '<img src="resources/comingsoon.png" alt="Coming Soon" style="max-width:100%; vertical-align:middle;">';
        }
      }

      function toggleBreakPricingOptions() {
        var menu = document.getElementById("breakPricingOptionsMenu");
        menu.classList.toggle("open-menu");
        window.dispatchEvent(new Event('resize'));
      }

      function toggleInputTooltip(labelElement) {
        var tooltip = labelElement.nextElementSibling;
        if (tooltip && tooltip.classList.contains('input-tooltip')) {
          tooltip.style.display = (tooltip.style.display === 'block') ? 'none' : 'block';
        }
      }

      let setData = [];
      let keyPlayersData = [];
      let pieChart;
      let tableData = [];
      const sortDirections = { 0: 1, 1: 1, 2: 1, 3: 1, 4: 1, 5: 1, 6: 1, 7: 1 };
      let highlightTeams = new Set();

      function parsePercentage(value) {
        value = value.toString().replace("%", "").trim();
        let num = parseFloat(value);
        if (isNaN(num)) return 0;
        if (num > 1) return num / 100;
        return num;
      }

      function darkenColor(color, percent) {
        let num = parseInt(color.slice(1), 16);
        let r = Math.max((num >> 16) - Math.round((num >> 16) * (percent/100)), 0);
        let g = Math.max(((num >> 8) & 0xff) - Math.round((((num >> 8) & 0xff) * (percent/100))), 0);
        let b = Math.max((num & 0xff) - Math.round((num & 0xff) * (percent/100)), 0);
        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
      }

      const dropShadowPlugin = {
        id: "dropShadowPlugin",
        beforeDatasetDraw(chart, args, options) {
          const ctx = chart.ctx;
          ctx.save();
          ctx.shadowColor = options.shadowColor || "rgba(0,0,0,0.5)";
          ctx.shadowBlur = options.shadowBlur || 10;
          ctx.shadowOffsetX = options.shadowOffsetX || 0;
          ctx.shadowOffsetY = options.shadowOffsetY || 10;
        },
        afterDatasetDraw(chart, args, options) {
          chart.ctx.restore();
        }
      };

      const legendMargin = {
        id: "legendMargin",
        beforeInit(chart) {
          chart.legend.afterFit = function() {
            this.height += 20;
          };
        }
      };

      function populateYearSelector() {
        const yearSelect = document.getElementById("yearSelect");
        yearSelect.innerHTML = '<option value="">--Select a Year--</option>';
        const years = [...new Set(setData.map(set => set.year))].sort(
          (a, b) => parseInt(b.split("-")[0]) - parseInt(a.split("-")[0])
        );
        years.forEach(year => {
          const option = document.createElement("option");
          option.value = year;
          option.textContent = year;
          yearSelect.appendChild(option);
        });
        buildYearDropdown(years);
        yearSelect.addEventListener("change", function() {
          document.getElementById("selectedYearLabel").textContent = yearSelect.value || "--Select a Year--";
          populateSetSelector();
          updateKeyPlayersSection();
          calculateProfit();
        });
        if (years.includes("2024-25")) {
          yearSelect.value = "2024-25";
          yearSelect.dispatchEvent(new Event("change"));
        }
      }

      function buildYearDropdown(years) {
        const yearDropdownMenu = document.getElementById("yearDropdownMenu");
        yearDropdownMenu.innerHTML = "";
        years.forEach(year => {
          const li = document.createElement("li");
          li.textContent = year;
          li.addEventListener("click", function() {
            const yearSelect = document.getElementById("yearSelect");
            yearSelect.value = year;
            yearSelect.dispatchEvent(new Event("change"));
            yearDropdownMenu.classList.remove("open");
          });
          yearDropdownMenu.appendChild(li);
        });
      }

      function populateSetSelector() {
        const selectedYear = document.getElementById("yearSelect").value;
        const setSelect = document.getElementById("setSelect");
        const previousValue = setSelect.value;
        setSelect.innerHTML = '<option value="">--Select Set--</option>';
        if (!selectedYear) return;
        const filteredSets = setData.filter(set => set.year === selectedYear).sort((a, b) => a.name.localeCompare(b.name));
        filteredSets.forEach(set => {
          const option = document.createElement("option");
          option.value = set.name;
          option.textContent = set.name;
          setSelect.appendChild(option);
        });
        if (!filteredSets.some(set => set.name === previousValue)) {
          setSelect.value = "";
          document.getElementById("selectedSetLabel").textContent = "--Select Set--";
        } else {
          setSelect.value = previousValue;
          document.getElementById("selectedSetLabel").textContent = previousValue;
        }
        buildSetDropdown(filteredSets);
      }

      function buildSetDropdown(filteredSets) {
        const setDropdownMenu = document.getElementById("setDropdownMenu");
        const setSelect = document.getElementById("setSelect");
        setDropdownMenu.innerHTML = "";
        filteredSets.forEach(s => {
          const li = document.createElement("li");
          li.textContent = s.name;
          li.addEventListener("click", function() {
            setSelect.value = s.name;
            setSelect.dispatchEvent(new Event("change"));
            setDropdownMenu.classList.remove("open");
          });
          setDropdownMenu.appendChild(li);
        });
      }

      function updateCasePrice() {
        const selectedYear = document.getElementById("yearSelect").value;
        const selectedSet = document.getElementById("setSelect").value;
        if (!selectedYear || !selectedSet) return;
        const setObj = setData.find(set => set.year === selectedYear && set.name === selectedSet);
        if (setObj && setObj.price) {
          const price = parseFloat(setObj.price.replace(/[$,]/g, ""));
          document.getElementById("casePrice").value = price;
          document.getElementById("casePriceDup").value = price;
        }
      }

      // Updated updateSetDetails to output the six tiles and accompanying text
      // into a container styled like the key rookies container.
      function updateSetDetails() {
        const selectedYear = document.getElementById("yearSelect").value;
        const selectedSet = document.getElementById("setSelect").value;
        const detailsDiv = document.getElementById("setDetailsContainer");
        if (!selectedYear || !selectedSet) {
          detailsDiv.innerHTML = "";
          return;
        }
        const setObj = setData.find(set => set.year === selectedYear && set.name === selectedSet);
        if (!setObj) {
          detailsDiv.innerHTML = "";
          return;
        }
        let cardsPerBox = (setObj.packs_per_box && setObj.cards_per_pack)
          ? Math.floor(setObj.packs_per_box * setObj.cards_per_pack * 10) / 10
          : "N/A";
        let cardsPerCase = (setObj.packs_per_box && setObj.cards_per_pack && setObj.boxes_per_case)
          ? Math.floor(setObj.packs_per_box * setObj.cards_per_pack * setObj.boxes_per_case * 10) / 10
          : "N/A";
        let html = `
          <div class="key-player-tiles-container" id="setDetailsTiles">
            <div class="key-player-tile">
              <div class="key-player-info">
                <strong>${formatDetail(setObj.rookie_percentage, true)}</strong>
                <span>Rookie %</span>
              </div>
            </div>
            <div class="key-player-tile">
              <div class="key-player-info">
                <strong>${formatDetail(setObj.boxes_per_case, false)}</strong>
                <span>Boxes/Case</span>
              </div>
            </div>
            <div class="key-player-tile">
              <div class="key-player-info">
                <strong>${formatDetail(setObj.cards_per_pack, false)}</strong>
                <span>Cards/Pack</span>
              </div>
            </div>
            <div class="key-player-tile">
              <div class="key-player-info">
                <strong>${formatDetail(cardsPerCase, false)}</strong>
                <span>Cards/Case</span>
              </div>
            </div>
            <div class="key-player-tile">
              <div class="key-player-info">
                <strong>${formatDetail(setObj.packs_per_box, false)}</strong>
                <span>Packs/Box</span>
              </div>
            </div>
            <div class="key-player-tile">
              <div class="key-player-info">
                <strong>${formatDetail(cardsPerBox, false)}</strong>
                <span>Cards/Box</span>
              </div>
            </div>
          </div>
          <p class="small-copy" style="text-align: center; margin-top: 10px;">
            ${setObj.year} ${setObj.name} was released on <strong>${setObj.release_date || "N/A"}</strong>. Each box contains ${setObj.box_breakdown || "N/A"}. 
            <a href="javascript:void(0)" onclick="toggleSetNotes(this)" class="pill-button" style="margin-left: 10px;">Read Set Notes</a>
          </p>
          <div class="set-notes" style="display:none;">
            <p><strong>Notes:</strong> ${setObj.notes || "N/A"}</p>
          </div>
        `;
        detailsDiv.innerHTML = html;
      }

      function openPlayerEbaySearch(playerName) {
        const selectedYear = document.getElementById("yearSelect").value;
        const selectedSet = document.getElementById("setSelect").value;
        if (!selectedYear || !selectedSet) { alert("Please select both a year and a set."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet + " " + playerName;
        window.open("https://www.ebay.com/sch/i.html?_nkw=" + encodeURIComponent(query) + "&_sop=16&rt=nc&LH_Sold=1&LH_Complete=1", "_blank");
      }

      function updateKeyPlayersSection() {
        const selectedYear = document.getElementById("yearSelect").value;
        const keySection = document.getElementById("keyPlayersSection");
        const tilesContainer = document.getElementById("keyPlayerTiles");
        tilesContainer.innerHTML = "";
        highlightTeams.clear();
        if (!selectedYear) { keySection.style.display = "none"; return; }
        document.querySelector("#keyPlayersSection h2").textContent = selectedYear + " Key Rookies";
        const filteredPlayers = keyPlayersData.filter(player =>
          (player.setYear === selectedYear || player.setYear === "All") && player.type.toLowerCase() === "rookie"
        );
        keySection.style.display = "block";
        filteredPlayers.forEach(player => { highlightTeams.add(player.team); });
        filteredPlayers.forEach(player => {
          const tile = document.createElement("div");
          tile.className = "key-player-tile";
          const teamLogo = document.createElement("img");
          teamLogo.className = "team-logo";
          teamLogo.src = teamLogos[player.team] || "";
          teamLogo.alt = player.team + " logo";
          tile.appendChild(teamLogo);
          const profileLink = document.createElement("a");
          profileLink.href = player.profile_link;
          profileLink.target = "_blank";
          const playerImg = document.createElement("img");
          playerImg.className = "player-img";
          playerImg.src = player.image;
          playerImg.alt = player.player;
          profileLink.appendChild(playerImg);
          tile.appendChild(profileLink);
          const infoDiv = document.createElement("div");
          infoDiv.className = "key-player-info";
          const nameLine = document.createElement("div");
          const nameLink = document.createElement("a");
          nameLink.href = player.profile_link;
          nameLink.target = "_blank";
          nameLink.style.textDecoration = "none";
          nameLink.style.color = "inherit";
          nameLink.textContent = player.player;
          nameLine.appendChild(nameLink);
          infoDiv.appendChild(nameLine);
          const notesLine = document.createElement("div");
          notesLine.className = "key-player-notes";
          notesLine.textContent = player.notes || "";
          infoDiv.appendChild(notesLine);
          const buttonsContainer = document.createElement("div");
          buttonsContainer.style.display = "inline-flex";
          buttonsContainer.style.gap = "4px";
          buttonsContainer.style.marginTop = "8px";
          const nhlLink = document.createElement("a");
          nhlLink.href = player.profile_link;
          nhlLink.target = "_blank";
          nhlLink.className = "nhl-btn";
          nhlLink.innerHTML = '<img src="resources/nhl_button.png" alt="NHL Profile" class="nhl-icon">';
          buttonsContainer.appendChild(nhlLink);
          const ebayLink = document.createElement("a");
          ebayLink.href = "javascript:void(0)";
          ebayLink.className = "ebay-btn";
          ebayLink.onclick = function() { openPlayerEbaySearch(player.player); };
          ebayLink.innerHTML = '<img src="resources/ebay_button.png" alt="eBay" class="ebay-icon">';
          buttonsContainer.appendChild(ebayLink);
          infoDiv.appendChild(buttonsContainer);
          tile.appendChild(infoDiv);
          tilesContainer.appendChild(tile);
        });
      }

      const teamLogos = {
        "Anaheim Ducks": "https://assets.nhle.com/logos/nhl/svg/ANA_dark.svg",
        "Arizona Coyotes": "https://assets.nhle.com/logos/nhl/svg/ARI_dark.svg",
        "Boston Bruins": "https://assets.nhle.com/logos/nhl/svg/BOS_dark.svg",
        "Buffalo Sabres": "https://assets.nhle.com/logos/nhl/svg/BUF_dark.svg",
        "Calgary Flames": "https://assets.nhle.com/logos/nhl/svg/CGY_dark.svg",
        "Carolina Hurricanes": "https://assets.nhle.com/logos/nhl/svg/CAR_dark.svg",
        "Chicago Blackhawks": "https://assets.nhle.com/logos/nhl/svg/CHI_dark.svg",
        "Colorado Avalanche": "https://assets.nhle.com/logos/nhl/svg/COL_dark.svg",
        "Columbus Blue Jackets": "https://assets.nhle.com/logos/nhl/svg/CBJ_dark.svg",
        "Dallas Stars": "https://assets.nhle.com/logos/nhl/svg/DAL_dark.svg",
        "Detroit Red Wings": "https://assets.nhle.com/logos/nhl/svg/DET_dark.svg",
        "Edmonton Oilers": "https://assets.nhle.com/logos/nhl/svg/EDM_dark.svg",
        "Florida Panthers": "https://assets.nhle.com/logos/nhl/svg/FLA_dark.svg",
        "Los Angeles Kings": "https://assets.nhle.com/logos/nhl/svg/LAK_dark.svg",
        "Minnesota Wild": "https://assets.nhle.com/logos/nhl/svg/MIN_dark.svg",
        "Montréal Canadiens": "https://assets.nhle.com/logos/nhl/svg/MTL_dark.svg",
        "Montreal Canadiens": "https://assets.nhle.com/logos/nhl/svg/MTL_dark.svg",
        "Nashville Predators": "https://assets.nhle.com/logos/nhl/svg/NSH_dark.svg",
        "New Jersey Devils": "https://assets.nhle.com/logos/nhl/svg/NJD_dark.svg",
        "New York Islanders": "https://assets.nhle.com/logos/nhl/svg/NYI_dark.svg",
        "New York Rangers": "https://assets.nhle.com/logos/nhl/svg/NYR_dark.svg",
        "Ottawa Senators": "https://assets.nhle.com/logos/nhl/svg/OTT_dark.svg",
        "Philadelphia Flyers": "https://assets.nhle.com/logos/nhl/svg/PHI_dark.svg",
        "Pittsburgh Penguins": "https://assets.nhle.com/logos/nhl/svg/PIT_dark.svg",
        "San Jose Sharks": "https://assets.nhle.com/logos/nhl/svg/SJS_dark.svg",
        "Seattle Kraken": "https://assets.nhle.com/logos/nhl/svg/SEA_dark.svg",
        "St. Louis Blues": "https://assets.nhle.com/logos/nhl/svg/STL_dark.svg",
        "Tampa Bay Lightning": "https://assets.nhle.com/logos/nhl/svg/TBL_dark.svg",
        "Toronto Maple Leafs": "https://assets.nhle.com/logos/nhl/svg/TOR_dark.svg",
        "Utah Hockey Club": "https://assets.nhle.com/logos/nhl/svg/UTA_dark.svg",
        "Vancouver Canucks": "https://assets.nhle.com/logos/nhl/svg/VAN_dark.svg",
        "Vegas Golden Knights": "https://assets.nhle.com/logos/nhl/svg/VGK_dark.svg",
        "Washington Capitals": "https://assets.nhle.com/logos/nhl/svg/WSH_dark.svg",
        "Winnipeg Jets": "https://assets.nhle.com/logos/nhl/svg/WPG_dark.svg"
      };

      function openSetSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet + " hockey hobby case";
        window.open("https://www.dacardworld.com/search/?Search=" + encodeURIComponent(query), "_blank");
      }

      function openSteelCitySearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet + " hockey hobby case";
        window.open("https://www.steelcitycollectibles.com/search?q=" + encodeURIComponent(query), "_blank");
      }

      function openTcdbSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet;
        window.open("https://www.tcdb.com/Search.cfm?SearchCategory=Hockey&q=" + encodeURIComponent(query), "_blank");
      }

      function openHockeyChecklistsSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet;
        window.open("https://hockeychecklists.com/checklist?search=" + encodeURIComponent(query), "_blank");
      }

      function openMidwestCardsSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet + " hockey hobby case";
        window.open("https://www.midwestcards.com/search/?search_query=" + encodeURIComponent(query), "_blank");
      }

      function openBlowoutCardsSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet + " hockey hobby case";
        window.open("https://www.blowoutcards.com/catalogsearch/result/?q=" + encodeURIComponent(query), "_blank");
      }

      function openOotbSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet + " hockey hobby case";
        window.open("https://www.outoftheboxcards.com/?s=" + encodeURIComponent(query), "_blank");
      }

      function openTeamSearch(teamName) {
        const selectedYear = document.getElementById("yearSelect").value;
        const selectedSet = document.getElementById("setSelect").value;
        if (!selectedYear || !selectedSet) { alert("Please select both a year and a set."); return; }
        const firstYear = selectedYear.split("-")[0];
        const query = firstYear + " " + selectedSet + " " + teamName;
        window.open("https://www.ebay.com/sch/i.html?_nkw=" + encodeURIComponent(query) + "&_sop=16&rt=nc&LH_Sold=1&LH_Complete=1", "_blank");
      }

      function calculateProfit() {
        const selectedYear = document.getElementById("yearSelect").value;
        const selectedSetName = document.getElementById("setSelect").value;
        const chartContainer = document.getElementById("chartContainer");
        const pieChartCanvas = document.getElementById("pieChart");
        const pieChartMessage = document.getElementById("pieChartMessage");
        if (selectedYear) {
          document.getElementById("selectedYearLabel").textContent = selectedYear;
        }
        if (selectedSetName) {
          document.getElementById("selectedSetLabel").textContent = selectedSetName;
        }
        if (!selectedYear || !selectedSetName) {
          chartContainer.style.display = "block";
          pieChartCanvas.style.display = "none";
          pieChartMessage.style.display = "flex";
          return;
        }
        const casePrice = parseFloat(document.getElementById("casePrice").value);
        const markupInput = document.getElementById("markup").value;
        let markupValue = parseFloat(markupInput);
        if (isNaN(markupValue)) markupValue = 0;
        const isDollar = document.getElementById("markupToggle").checked;
        const userDiscount = parsePercentage(document.getElementById("userDiscount").value);
        const blendedTax = parsePercentage(document.getElementById("blendedTax").value);
        const supplies = parseFloat(document.getElementById("supplies").value);
        
        const setObj = setData.find(set => set.year === selectedYear && set.name === selectedSetName);
        if (!setObj) return;
        
        let cardsPerCase = (setObj.packs_per_box && setObj.cards_per_pack && setObj.boxes_per_case)
          ? Math.floor(setObj.packs_per_box * setObj.cards_per_pack * setObj.boxes_per_case * 10) / 10
          : NaN;
          
        const teamData = setObj.cards || setObj.most_numbered_cards;
        let totalCards = 0;
        for (let team in teamData) { totalCards += teamData[team]; }
        let rows = [];
        for (let team in teamData) {
          const count = teamData[team];
          const cost = (count / totalCards) * casePrice;
          let basePrice;
          if (isDollar) {
            basePrice = cost + ((count / totalCards) * markupValue);
          } else {
            basePrice = cost * (1 + (markupValue / 100));
          }
          const distributedPrice = basePrice * (1 - userDiscount);
          const whatnotFees = distributedPrice * 0.08;
          const transactionFees = (distributedPrice * (1 + blendedTax)) * 0.029 + 0.3;
          const profit = distributedPrice - cost - whatnotFees - transactionFees - supplies;
          const distribution = ((count / totalCards) * 100).toFixed(1) + "%";
          rows.push({
            team: team,
            logo: teamLogos[team] || "",
            count: count,
            distribution: distribution,
            cost: cost,
            price: distributedPrice,
            whatnotFees: whatnotFees,
            transactionFees: transactionFees,
            profit: profit
          });
        }
        let totalProfit = rows.reduce((sum, row) => sum + row.profit, 0);
        let whatnotCut = rows.reduce((sum, row) => sum + row.whatnotFees, 0);
        let costOfBusiness = rows.reduce((sum, row) => sum + row.transactionFees, 0) + rows.length * supplies;
        document.querySelector("#totalProfitBox .amount").textContent = "$" + totalProfit.toFixed(2);
        document.querySelector("#whatnotsCutBox .amount").textContent = "$" + whatnotCut.toFixed(2);
        document.querySelector("#costOfBusinessBox .amount").textContent = "$" + costOfBusiness.toFixed(2);
        
        let fullHeader = '<table id="fullResultsTable"><thead><tr>' +
          '<th data-sort="text" onclick="sortTableFull(0)">Team</th>' +
          '<th data-sort="number" onclick="sortTableFull(1)">Numbered Card Distribution</th>' +
          '<th data-sort="number" onclick="sortTableFull(2)">Distributed Cost</th>' +
          '<th data-sort="number" onclick="sortTableFull(3)">Distributed Cost + Markup</th>' +
          '<th data-sort="number" onclick="sortTableFull(4)">Whatnot Fees</th>' +
          '<th data-sort="number" onclick="sortTableFull(5)">Transaction Fees</th>' +
          '<th data-sort="number" onclick="sortTableFull(6)">Potential Profit</th>' +
          '</tr></thead><tbody>';
        let fullRowsHtml = rows.map(row => {
          return `<tr class="${highlightTeams.has(row.team) ? 'highlight' : ''}">
            <td>
              <a href="javascript:void(0)" onclick="openTeamSearch('${row.team.replace(/'/g, "\\'")}')" style="color:#fff; text-decoration:none;">
                <img src="${row.logo}" alt="${row.team}" style="width:40px; vertical-align:middle; margin-right:10px;">${row.team}
              </a>
              <a href="javascript:void(0)" onclick="openTeamSearch('${row.team.replace(/'/g, "\\'")}')" class="ebay-btn" style="margin-left:5px;">
                <img src="resources/ebay_button.png" alt="eBay" class="ebay-icon">
              </a>
            </td>
            <td>${row.distribution}</td>
            <td>$${row.cost.toFixed(2)}</td>
            <td>$${row.price.toFixed(2)}</td>
            <td>$${row.whatnotFees.toFixed(2)}</td>
            <td>$${row.transactionFees.toFixed(2)}</td>
            <td>$${row.profit.toFixed(2)}</td>
          </tr>`;
        }).join("");
        let fullTableHtml = fullHeader + fullRowsHtml + "</tbody></table>";
        
        let trimmedHeader = '<table id="resultsTable"><thead><tr>' +
          '<th data-sort="text" onclick="sortTableTrimmed(0)">Team</th>' +
          '<th data-sort="number" onclick="sortTableTrimmed(1)">Numbered Cards</th>' +
          '<th data-sort="number" onclick="sortTableTrimmed(2)">Numbered Card Distribution</th>' +
          '<th data-sort="number" onclick="sortTableTrimmed(3)">Avg. Total Cards per Case</th>' +
          '<th data-sort="number" onclick="sortTableTrimmed(4)">Distributed Cost + Markup</th>' +
          '</tr></thead><tbody>';
        let trimmedRowsHtml = rows.map(row => {
          let expectedCards = cardsPerCase * (row.count / totalCards);
          return `<tr class="${highlightTeams.has(row.team) ? 'highlight' : ''}">
            <td>
              <a href="javascript:void(0)" onclick="openTeamSearch('${row.team.replace(/'/g, "\\'")}')" style="color:#fff; text-decoration:none;">
                <img src="${row.logo}" alt="${row.team}" style="width:40px; vertical-align:middle; margin-right:10px;">${row.team}
              </a>
              <a href="javascript:void(0)" onclick="openTeamSearch('${row.team.replace(/'/g, "\\'")}')" class="ebay-btn" style="margin-left:5px;">
                <img src="resources/ebay_button.png" alt="eBay" class="ebay-icon">
              </a>
            </td>
            <td>${row.count}</td>
            <td>${row.distribution}</td>
            <td>${expectedCards.toFixed(1)}</td>
            <td>$${row.price.toFixed(2)}</td>
          </tr>`;
        }).join("");
        let trimmedTableHtml = trimmedHeader + trimmedRowsHtml + "</tbody></table>";
        
        document.getElementById("fullResults").innerHTML = fullTableHtml;
        document.getElementById("results").innerHTML = trimmedTableHtml;
        if (rows.length > 0) {
          document.getElementById("teamPricesHeader").style.display = "block";
          document.getElementById("distributionCopy").style.display = "block";
        } else {
          document.getElementById("teamPricesHeader").style.display = "none";
          document.getElementById("distributionCopy").style.display = "none";
        }
        tableData = rows;
        const chartData = [totalProfit, whatnotCut, costOfBusiness];
        chartContainer.style.display = "block";
        if (chartData.every(val => val === 0)) {
          pieChartCanvas.style.display = "none";
          pieChartMessage.style.display = "flex";
        } else {
          pieChartCanvas.style.display = "block";
          pieChartMessage.style.display = "none";
          if (pieChart) {
            pieChart.data.datasets[0].data = chartData;
            pieChart.update();
          } else {
            const ctx = pieChartCanvas.getContext("2d");
            pieChart = new Chart(ctx, {
              type: "pie",
              data: {
                labels: ["Breaker's Profit", "Whatnot's Cut", "Cost of Business"],
                datasets: [{
                  data: chartData,
                  backgroundColor: ["#2e7d32", "#bfa600", "#007bff"],
                  offset: 30,
                  borderWidth: 0,
                  borderColor: "transparent"
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: { padding: { bottom: 0 } },
                plugins: {
                  legend: {
                    position: "bottom",
                    labels: { font: { family: "BreakPricingFont" }, color: "#e0e0e0" }
                  },
                  dropShadowPlugin: { shadowBlur: 10, shadowOffsetX: 0, shadowOffsetY: 10, shadowColor: "rgba(0,0,0,0.5)" }
                },
                elements: { arc: { borderWidth: 0, borderColor: "transparent" } }
              },
              plugins: [dropShadowPlugin, legendMargin]
            });
          }
        }
      }

      function sortTableFull(n) {
        const table = document.getElementById("fullResultsTable");
        const tbody = table.tBodies[0];
        const rows = Array.from(tbody.rows);
        let dir = sortDirections[n] || 1;
        rows.sort((a, b) => {
          let aText = a.cells[n].textContent.trim();
          let bText = b.cells[n].textContent.trim();
          let aNum = parseFloat(aText.replace(/[^0-9.-]/g, ""));
          let bNum = parseFloat(bText.replace(/[^0-9.-]/g, ""));
          if (!isNaN(aNum) && !isNaN(bNum)) { return (aNum - bNum) * dir; }
          return aText.localeCompare(bText) * dir;
        });
        rows.forEach(row => tbody.appendChild(row));
        sortDirections[n] = -dir;
      }

      function sortTableTrimmed(n) {
        const table = document.getElementById("resultsTable");
        const tbody = table.tBodies[0];
        const rows = Array.from(tbody.rows);
        let dir = sortDirections[n] || 1;
        rows.sort((a, b) => {
          let aText = a.cells[n].textContent.trim();
          let bText = b.cells[n].textContent.trim();
          let aNum = parseFloat(aText.replace(/[^0-9.-]/g, ""));
          let bNum = parseFloat(bText.replace(/[^0-9.-]/g, ""));
          if (!isNaN(aNum) && !isNaN(bNum)) { return (aNum - bNum) * dir; }
          return aText.localeCompare(bText) * dir;
        });
        rows.forEach(row => tbody.appendChild(row));
        sortDirections[n] = -dir;
      }

      const summaryBoxes = document.querySelectorAll(".summary-box");
      summaryBoxes.forEach(box => {
        box.addEventListener("click", function() {
          const toast = this.querySelector(".toast");
          toast.style.display = (toast.style.display === "block") ? "none" : "block";
        });
      });

      function toggleSetNotes(link) {
        var notesDiv = link.parentElement.nextElementSibling;
        if (notesDiv.style.display === "none" || notesDiv.style.display === "") {
          notesDiv.style.display = "block";
          link.textContent = "Hide Set Notes";
        } else {
          notesDiv.style.display = "none";
          link.textContent = "Read Set Notes";
        }
      }

      document.getElementById("selectedYearLabel").addEventListener("click", function() {
        const menu = document.getElementById("yearDropdownMenu");
        menu.classList.toggle("open");
      });
      document.getElementById("selectedSetLabel").addEventListener("click", function() {
        const menu = document.getElementById("setDropdownMenu");
        menu.classList.toggle("open");
      });

      document.getElementById("priceSettingsButton").addEventListener("click", function(e) {
        e.preventDefault();
        var dup = document.getElementById("priceSettingsDuplicate");
        dup.classList.toggle("open-menu");
      });

      document.getElementById("markupDup").addEventListener("input", function() {
        document.getElementById("markup").value = this.value;
        calculateProfit();
      });
      document.getElementById("markup").addEventListener("input", function() {
        document.getElementById("markupDup").value = this.value;
      });

      document.getElementById("markupToggleDup").addEventListener("change", function() {
        document.getElementById("markupToggle").checked = this.checked;
        updateMarkupToggleLabel();
        calculateProfit();
      });
      document.getElementById("markupToggle").addEventListener("change", function() {
        document.getElementById("markupToggleDup").checked = this.checked;
        updateMarkupToggleLabel();
        calculateProfit();
      });
      function updateMarkupToggleLabel() {
        const isDollar = document.getElementById("markupToggle").checked;
        document.getElementById("markupToggleLabel").textContent = isDollar ? "$" : "%";
        document.getElementById("markupToggleLabelDup").textContent = isDollar ? "$" : "%";
      }

      document.getElementById("userDiscountDup").addEventListener("input", function() {
        document.getElementById("userDiscount").value = this.value;
        calculateProfit();
      });
      document.getElementById("userDiscount").addEventListener("input", function() {
        document.getElementById("userDiscountDup").value = this.value;
      });
      document.getElementById("blendedTaxDup").addEventListener("input", function() {
        document.getElementById("blendedTax").value = this.value;
        calculateProfit();
      });
      document.getElementById("blendedTax").addEventListener("input", function() {
        document.getElementById("blendedTaxDup").value = this.value;
      });
      document.getElementById("suppliesDup").addEventListener("input", function() {
        document.getElementById("supplies").value = this.value;
        calculateProfit();
      });
      document.getElementById("supplies").addEventListener("input", function() {
        document.getElementById("suppliesDup").value = this.value;
      });

      window.addEventListener("load", function() {
        fetch("config.json")
          .then(response => {
            if (!response.ok) { throw new Error("Network response was not ok: " + response.statusText); }
            return response.json();
          })
          .then(jsonData => {
            if (!jsonData.sets) { alert('Invalid JSON format: missing "sets" property.'); return; }
            setData = jsonData.sets;
            keyPlayersData = jsonData["Key Players"] || [];
            populateYearSelector();
            document.getElementById("setSelect").addEventListener("change", function() {
              document.getElementById("selectedSetLabel").textContent = this.value || "--Select Set--";
              updateCasePrice();
              updateSetDetails();
              calculateProfit();
            });
          })
          .catch(error => {
            console.error("Error fetching config.json:", error);
          });
      });
    </script>
  </body>
</html>
