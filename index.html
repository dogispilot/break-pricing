<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>SkunkSniper.com</title>
    <link rel="icon" type="image/png" href="/resources/skunk.png" />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap"
      rel="stylesheet"
    />
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PL5RQPB0MT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('js', new Date());
      gtag('config','G-PL5RQPB0MT');
    </script>
    <style>
      /* Basic fonts and resets */
      @font-face {
        font-family: 'BreakPricingFont';
        src: url('fonts/breakpricingfont.ttf') format('truetype');
      }
      @font-face {
        font-family: 'BreakPricingFontBold';
        src: url('fonts/breakpricingfont_bold.ttf') format('truetype');
      }
      body {
        font-family: 'BreakPricingFont', sans-serif;
        background: #121212;
        color: #e0e0e0;
        margin: 0;
        padding: 20px;
      }
      .about-link {
        position: absolute;
        top: 20px;
        right: 20px;
        color: #e0e0e0;
        text-decoration: none;
        font-size: 1rem;
        z-index: 1000;
      }
      .about-link:hover {
        text-decoration: underline;
      }
      .container {
        position: relative;
        max-width: 900px;
        margin: 0 auto;
        background: #1e1e1e;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      }
      .header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 25px;
      }
      .header img {
        width: 60px;
        margin-bottom: 10px;
      }
      h1 {
        font-family: 'BreakPricingFontBold', sans-serif;
        font-size: 2rem;
        margin: 0;
      }
      .subtitle {
        font-size: 1.2rem;
        margin: 5px 0 0 0;
      }
      h2 {
        text-align: center;
        margin-top: 0;
      }
      /* Custom dropdowns */
      #selectionSentence {
        text-align: center;
        font-size: 1.8rem;
        margin-bottom: 20px;
      }
      .dropdown-container {
        display: inline-block;
        position: relative;
        cursor: pointer;
      }
      .dropdown-label {
        text-decoration: underline;
        font-weight: 900;
        font-size: 2rem;
        color: #ffee00;
      }
      .dropdown-menu {
        display: none;
        position: absolute;
        background: #2c2c2c;
        min-width: 160px;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        margin-top: 6px;
        z-index: 9999;
        padding: 0;
        list-style: none;
      }
      .dropdown-menu.open {
        display: block;
      }
      .dropdown-menu li {
        padding: 8px 12px;
        white-space: nowrap;
        color: #fff;
        cursor: pointer;
      }
      .dropdown-menu li:hover {
        background: #444;
      }
      /* Hidden native selects */
      form#calcForm .form-row {
        display: none;
      }
      /* Key Rookies Section */
      #keyPlayersSection {
        margin-top: 30px;
        padding: 15px;
        background: #2c2c2c;
        border-radius: 8px;
        display: none;
      }
      .key-player-tiles-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 5px 30px;
        justify-items: center;
      }
      .key-player-tile {
        background: #1e1e1e;
        padding: 10px;
        margin: 10px 0;
        border-radius: 8px;
        display: flex;
        align-items: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      }
      .key-player-tile img.team-logo {
        width: 67.5px;
        height: 67.5px;
        border-radius: 50%;
        opacity: 0.75;
        vertical-align: middle;
      }
      .key-player-tile img.player-img {
        width: 75px;
        height: 75px;
        border-radius: 50%;
        object-fit: cover;
        margin-left: -20px;
        vertical-align: middle;
        z-index: 1;
      }
      .key-player-info {
        display: flex;
        flex-direction: column;
      }
      .key-player-notes {
        font-size: 0.9rem;
        color: #bbb;
      }
      /* Set details, profit, and table styling (compressed for brevity) */
      /* ... [Other CSS remains unchanged from previous versions] ... */
      /* For brevity, please keep your original CSS for profit tables, toggle switches, etc. */
    </style>
  </head>
  <body>
    <div class="container">
      <a href="howitworks.html" class="about-link" style="right:70px;">How it Works</a>
      <a href="about.html" class="about-link" style="right:20px;">About</a>
      <div class="header">
        <img src="resources/skunk.png" alt="SkunkSniper Logo" />
        <h1>SkunkSniper.com</h1>
        <p class="subtitle">Sniff out the best breaks.</p>
      </div>
      <!-- Custom Dropdown Sentence -->
      <div id="selectionSentence">
        I want to explore 
        <span class="dropdown-container">
          <span class="dropdown-label" id="selectedSetLabel">--Select a Set--</span>
          <ul class="dropdown-menu" id="setDropdownMenu"></ul>
        </span>
        for the years 
        <span class="dropdown-container">
          <span class="dropdown-label" id="selectedYearLabel">--Select a Year--</span>
          <ul class="dropdown-menu" id="yearDropdownMenu"></ul>
        </span>.
      </div>
      <!-- Hidden native selects (used for internal data binding) -->
      <form id="calcForm">
        <div class="form-row">
          <div class="form-group">
            <label for="yearSelect">Select Year</label>
            <select id="yearSelect" required>
              <option value="">--Select a Year--</option>
            </select>
          </div>
          <div class="form-group">
            <label for="setSelect">Select a Set</label>
            <select id="setSelect" required>
              <option value="">--Select Set--</option>
            </select>
          </div>
          <!-- Other native controls for lookup buttons‚Ä¶ -->
        </div>
      </form>
      <!-- Set Details Section -->
      <div id="setDetails" style="margin-bottom:20px;"></div>
      <!-- Key Rookies Section (will show if matching key players exist) -->
      <div id="keyPlayersSection">
        <h2 style="margin-top:5px;">üîë Key Rookies üîë</h2>
        <div class="key-player-tiles-container" id="keyPlayerTiles"></div>
      </div>
      <!-- Sniffer Section and Profit Tables (unchanged from before) -->
      <div class="sniffer-section-container">
        <h2 id="teamPricesHeader">üëÉ Break Sniffer üëÉ</h2>
        <p class="small-copy" id="distributionCopy">
          Highlighted rows represent teams with key rookies.
          <a href="#" id="priceSettingsButton" class="pill-button" style="margin-left:10px;">Price Settings</a>
        </p>
        <!-- [Price Settings Duplicate and profit table markup here] -->
      </div>
      <div id="results">
        <div class="empty-state">
          <p>Please select a year and set to get started sniping.</p>
        </div>
      </div>
      <div id="fullResults" style="display:none!important;"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Global variables for sets and key players
      let setData = [];
      let keyPlayersData = [];
      const sortDirections = {0: 1, 1: 1, 2: 1, 3: 1, 4: 1, 5: 1, 6: 1, 7: 1};
      let highlightTeams = new Set();
      let pieChart, tableData;

      // Utility functions (formatDetail, toggleInputTooltip, parsePercentage, dropShadowPlugin, legendMargin)
      function formatDetail(val, isRookie) {
        let num = parseFloat(val);
        if (!isNaN(num)) {
          return isRookie ? (Math.floor(num * 10) / 10).toFixed(1) + "%" : (num % 1 === 0 ? num.toFixed(0) : num.toFixed(1));
        } else {
          return '<img src="resources/comingsoon.png" alt="Coming Soon" style="max-width:100%;vertical-align:middle;">';
        }
      }
      function toggleInputTooltip(labelElement) {
        var tooltip = labelElement.nextElementSibling;
        if (tooltip && tooltip.classList.contains('input-tooltip')) {
          tooltip.style.display = (tooltip.style.display === 'block') ? 'none' : 'block';
        }
      }
      function parsePercentage(value) {
        value = value.toString().replace("%", "").trim();
        let num = parseFloat(value);
        return isNaN(num) ? 0 : (num > 1 ? num / 100 : num);
      }
      const dropShadowPlugin = {
        id: "dropShadowPlugin",
        beforeDatasetDraw(chart, args, options) {
          const ctx = chart.ctx;
          ctx.save();
          ctx.shadowColor = options.shadowColor || "rgba(0,0,0,0.5)";
          ctx.shadowBlur = options.shadowBlur || 10;
          ctx.shadowOffsetX = options.shadowOffsetX || 0;
          ctx.shadowOffsetY = options.shadowOffsetY || 10;
        },
        afterDatasetDraw(chart, args, options) {
          chart.ctx.restore();
        }
      };
      const legendMargin = {
        id: "legendMargin",
        beforeInit(chart) {
          chart.legend.afterFit = function() {
            this.height += 20;
          };
        }
      };

      // Dropdown and select population functions
      function populateYearSelector() {
        const yearSelect = document.getElementById("yearSelect");
        yearSelect.innerHTML = '<option value="">--Select a Year--</option>';
        const years = [...new Set(setData.map(set => set.year))].sort((a, b) =>
          parseInt(b.split("-")[0]) - parseInt(a.split("-")[0])
        );
        years.forEach(year => {
          const option = document.createElement("option");
          option.value = year;
          option.textContent = year;
          yearSelect.appendChild(option);
        });
        buildYearDropdown(years);
        yearSelect.addEventListener("change", function() {
          document.getElementById("selectedYearLabel").textContent = this.value || "--Select a Year--";
          populateSetSelector();
          updateSetDetails();
          updateCasePrice();
          updateKeyPlayersSection();
          calculateProfit();
        });
        if (years.includes("2024-25")) {
          yearSelect.value = "2024-25";
          yearSelect.dispatchEvent(new Event("change"));
        }
      }
      function buildYearDropdown(years) {
        const yearDropdownMenu = document.getElementById("yearDropdownMenu");
        yearDropdownMenu.innerHTML = "";
        years.forEach(year => {
          const li = document.createElement("li");
          li.textContent = year;
          li.addEventListener("click", function() {
            document.getElementById("yearSelect").value = year;
            document.getElementById("yearSelect").dispatchEvent(new Event("change"));
            yearDropdownMenu.classList.remove("open");
          });
          yearDropdownMenu.appendChild(li);
        });
      }
      function populateSetSelector() {
        const selectedYear = document.getElementById("yearSelect").value;
        const setSelect = document.getElementById("setSelect");
        const previousValue = setSelect.value;
        setSelect.innerHTML = '<option value="">--Select Set--</option>';
        if (!selectedYear) return;
        const filteredSets = setData.filter(set => set.year === selectedYear).sort((a, b) => a.name.localeCompare(b.name));
        filteredSets.forEach(set => {
          const option = document.createElement("option");
          option.value = set.name;
          option.textContent = set.name;
          setSelect.appendChild(option);
        });
        if (!filteredSets.some(set => set.name === previousValue)) {
          setSelect.value = "";
          document.getElementById("selectedSetLabel").textContent = "--Select Set--";
        } else {
          setSelect.value = previousValue;
          document.getElementById("selectedSetLabel").textContent = previousValue;
        }
        buildSetDropdown(filteredSets);
      }
      function buildSetDropdown(filteredSets) {
        const setDropdownMenu = document.getElementById("setDropdownMenu");
        setDropdownMenu.innerHTML = "";
        filteredSets.forEach(s => {
          const li = document.createElement("li");
          li.textContent = s.name;
          li.addEventListener("click", function() {
            document.getElementById("setSelect").value = s.name;
            document.getElementById("setSelect").dispatchEvent(new Event("change"));
            setDropdownMenu.classList.remove("open");
          });
          setDropdownMenu.appendChild(li);
        });
      }
      // Attach change event listener to the native setSelect element
      document.getElementById("setSelect").addEventListener("change", function() {
        document.getElementById("selectedSetLabel").textContent = this.value || "--Select Set--";
        updateSetDetails();
        updateCasePrice();
        updateKeyPlayersSection();
        calculateProfit();
      });
      function updateCasePrice() {
        const selectedYear = document.getElementById("yearSelect").value;
        const selectedSet = document.getElementById("setSelect").value;
        if (!selectedYear || !selectedSet) return;
        const setObj = setData.find(set => set.year === selectedYear && set.name === selectedSet);
        if (setObj && setObj.price) {
          const price = parseFloat(setObj.price.replace(/[$,]/g, ""));
          document.getElementById("casePrice").value = price;
          document.getElementById("casePriceDup").value = price;
        }
      }
      function updateSetDetails() {
        const selectedYear = document.getElementById("yearSelect").value;
        const selectedSet = document.getElementById("setSelect").value;
        const detailsDiv = document.getElementById("setDetails");
        if (!selectedYear || !selectedSet) { detailsDiv.innerHTML = ""; return; }
        const setObj = setData.find(set => set.year === selectedYear && set.name === selectedSet);
        if (!setObj) { detailsDiv.innerHTML = ""; return; }
        let cardsPerBox = (setObj.packs_per_box && setObj.cards_per_pack)
          ? Math.floor(setObj.packs_per_box * setObj.cards_per_pack * 10) / 10
          : NaN;
        let cardsPerCase = (setObj.packs_per_box && setObj.cards_per_pack && setObj.boxes_per_case)
          ? Math.floor(setObj.packs_per_box * setObj.cards_per_pack * setObj.boxes_per_case * 10) / 10
          : NaN;
        let html = `
          <div class="setDetails-grid-4col">
            <div class="detail-box highlight-tile" style="grid-column: 1; grid-row: 1 / span 2;">
              <div class="detail-value">${formatDetail(setObj.rookie_percentage, true)}</div>
              <div class="detail-label">Rookie Percentage</div>
            </div>
            <div class="detail-box" style="grid-column: 2; grid-row: 1;">
              <div class="detail-value">${formatDetail(setObj.boxes_per_case, false)}</div>
              <div class="detail-label">Boxes per Case</div>
            </div>
            <div class="detail-box" style="grid-column: 3; grid-row: 1;">
              <div class="detail-value">${formatDetail(setObj.cards_per_pack, false)}</div>
              <div class="detail-label">Cards per Pack</div>
            </div>
            <div class="detail-box highlight-tile" style="grid-column: 4; grid-row: 1 / span 2;">
              <div class="detail-value">${formatDetail(cardsPerCase, false)}</div>
              <div class="detail-label">Cards per Case</div>
            </div>
            <div class="detail-box" style="grid-column: 2; grid-row: 2;">
              <div class="detail-value">${formatDetail(setObj.packs_per_box, false)}</div>
              <div class="detail-label">Packs per Box</div>
            </div>
            <div class="detail-box" style="grid-column: 3; grid-row: 2;">
              <div class="detail-value">${formatDetail(cardsPerBox, false)}</div>
              <div class="detail-label">Cards per Box</div>
            </div>
          </div>
        `;
        html += `
          <p>${setObj.year} ${setObj.name} was released on <strong>${setObj.release_date || "N/A"}</strong>. Each box contains ${setObj.box_breakdown || "N/A"}. 
            <a href="javascript:void(0)" onclick="toggleSetNotes(this)" class="pill-button">Read Set Notes</a>
          </p>
          <div class="set-notes" style="display:none;">
            <p><strong>Notes:</strong> ${setObj.notes || "N/A"}</p>
          </div>
        `;
        detailsDiv.innerHTML = '<div class="set-details-container"><h2 style="text-align:center;margin-top:5px;font-family:\'BreakPricingFontBold\', sans-serif;">üìù Set Details üìù</h2>' + html + '</div>';
      }
      // Update key players section using keyPlayersData from config.json.
      function updateKeyPlayersSection() {
        const selectedYear = document.getElementById("yearSelect").value;
        const selectedSet = document.getElementById("setSelect").value;
        const keySection = document.getElementById("keyPlayersSection");
        const tilesContainer = document.getElementById("keyPlayerTiles");
        tilesContainer.innerHTML = "";
        if (!selectedYear || !selectedSet) {
          keySection.style.display = "none";
          return;
        }
        // Filter key players where type === "Rookie" (case-insensitive) and matching year and set.
        const matchingKeyRookies = keyPlayersData.filter(player =>
          player.type && player.type.toLowerCase() === "rookie" &&
          player.year === selectedYear &&
          player.set === selectedSet
        );
        if (!matchingKeyRookies.length) {
          keySection.style.display = "none";
          return;
        }
        keySection.style.display = "block";
        document.querySelector("#keyPlayersSection h2").textContent = "üîë " + selectedYear + " Key Rookies üîë";
        matchingKeyRookies.forEach(player => {
          const tile = document.createElement("div");
          tile.className = "key-player-tile";
          const teamLogo = document.createElement("img");
          teamLogo.className = "team-logo";
          teamLogo.src = teamLogos[player.team] || "";
          teamLogo.alt = player.team + " logo";
          tile.appendChild(teamLogo);
          const playerImg = document.createElement("img");
          playerImg.className = "player-img";
          playerImg.src = player.image || teamLogos[player.team] || "resources/placeholder.png";
          playerImg.alt = player.player || player.team;
          tile.appendChild(playerImg);
          const infoDiv = document.createElement("div");
          infoDiv.className = "key-player-info";
          const nameLine = document.createElement("div");
          nameLine.textContent = player.player || player.team;
          infoDiv.appendChild(nameLine);
          const notesLine = document.createElement("div");
          notesLine.className = "key-player-notes";
          notesLine.textContent = player.notes || "";
          infoDiv.appendChild(notesLine);
          tile.appendChild(infoDiv);
          tilesContainer.appendChild(tile);
        });
      }
      // External search functions (openSetSearch, openSteelCitySearch, openTcdbSearch, openHockeyChecklistsSearch, openMidwestCardsSearch, openBlowoutCardsSearch, openOotbSearch, openTeamSearch)
      function openSetSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet + " hockey hobby case";
        window.open("https://www.dacardworld.com/search/?Search=" + encodeURIComponent(query), "_blank");
      }
      function openSteelCitySearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet + " hockey hobby case";
        window.open("https://www.steelcitycollectibles.com/search?q=" + encodeURIComponent(query), "_blank");
      }
      function openTcdbSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet;
        window.open("https://www.tcdb.com/Search.cfm?SearchCategory=Hockey&q=" + encodeURIComponent(query), "_blank");
      }
      function openHockeyChecklistsSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet;
        window.open("https://hockeychecklists.com/checklist?search=" + encodeURIComponent(query), "_blank");
      }
      function openMidwestCardsSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet + " hockey hobby case";
        window.open("https://www.midwestcards.com/search/?search_query=" + encodeURIComponent(query), "_blank");
      }
      function openBlowoutCardsSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet + " hockey hobby case";
        window.open("https://www.blowoutcards.com/catalogsearch/result/?q=" + encodeURIComponent(query), "_blank");
      }
      function openOotbSearch() {
        const selectedSet = document.getElementById("setSelect").value;
        const selectedYear = document.getElementById("yearSelect").value;
        if (!selectedSet) { alert("Please select a set first."); return; }
        if (!selectedYear) { alert("Please select a set year first."); return; }
        const yearPrefix = selectedYear.split("-")[0];
        const query = yearPrefix + " " + selectedSet + " hockey hobby case";
        window.open("https://www.outoftheboxcards.com/?s=" + encodeURIComponent(query), "_blank");
      }
      function openTeamSearch(teamName) {
        const selectedYear = document.getElementById("yearSelect").value;
        const selectedSet = document.getElementById("setSelect").value;
        if (!selectedYear || !selectedSet) { alert("Please select both a year and a set."); return; }
        const firstYear = selectedYear.split("-")[0];
        const query = firstYear + " " + selectedSet + " " + teamName;
        window.open("https://www.ebay.com/sch/i.html?_nkw=" + encodeURIComponent(query) + "&_sop=16&rt=nc&LH_Sold=1&LH_Complete=1", "_blank");
      }
      // Profit calculation and table functions (unchanged)
      function calculateProfit() {
        const selectedYear = document.getElementById("yearSelect").value;
        const selectedSetName = document.getElementById("setSelect").value;
        const chartContainer = document.getElementById("chartContainer");
        const pieChartCanvas = document.getElementById("pieChart");
        const pieChartMessage = document.getElementById("pieChartMessage");
        if (selectedYear) document.getElementById("selectedYearLabel").textContent = selectedYear;
        if (selectedSetName) document.getElementById("selectedSetLabel").textContent = selectedSetName;
        if (!selectedYear || !selectedSetName) {
          chartContainer.style.display = "block";
          pieChartCanvas.style.display = "none";
          pieChartMessage.style.display = "flex";
          return;
        }
        const casePrice = parseFloat(document.getElementById("casePrice").value);
        let markupValue = parseFloat(document.getElementById("markup").value);
        if (isNaN(markupValue)) markupValue = 0;
        const isDollar = document.getElementById("markupToggle").checked;
        const userDiscount = parsePercentage(document.getElementById("userDiscount").value);
        const blendedTax = parsePercentage(document.getElementById("blendedTax").value);
        const supplies = parseFloat(document.getElementById("supplies").value);
        const setObj = setData.find(set => set.year === selectedYear && set.name === selectedSetName);
        if (!setObj) return;
        let cardsPerCase = (setObj.packs_per_box && setObj.cards_per_pack && setObj.boxes_per_case)
          ? Math.floor(setObj.packs_per_box * setObj.cards_per_pack * setObj.boxes_per_case * 10) / 10
          : NaN;
        const teamData = setObj.cards || setObj.most_numbered_cards;
        let totalCards = 0;
        for (let team in teamData) { totalCards += teamData[team]; }
        let rows = [];
        for (let team in teamData) {
          const count = teamData[team];
          const cost = (count / totalCards) * casePrice;
          let basePrice = isDollar ? cost + ((count / totalCards) * markupValue) : cost * (1 + (markupValue / 100));
          const distributedPrice = basePrice * (1 - userDiscount);
          const whatnotFees = distributedPrice * 0.08;
          const transactionFees = (distributedPrice * (1 + blendedTax)) * 0.029 + 0.3;
          const profit = distributedPrice - cost - whatnotFees - transactionFees - supplies;
          const distribution = ((count / totalCards) * 100).toFixed(1) + "%";
          rows.push({ team, logo: teamLogos[team] || "", count, distribution, cost, price: distributedPrice, whatnotFees, transactionFees, profit });
        }
        let totalProfit = rows.reduce((sum, row) => sum + row.profit, 0);
        let whatnotCut = rows.reduce((sum, row) => sum + row.whatnotFees, 0);
        let costOfBusiness = rows.reduce((sum, row) => sum + row.transactionFees, 0) + rows.length * supplies;
        document.querySelector("#totalProfitBox .amount").textContent = "$" + totalProfit.toFixed(2);
        document.querySelector("#whatnotsCutBox .amount").textContent = "$" + whatnotCut.toFixed(2);
        document.querySelector("#costOfBusinessBox .amount").textContent = "$" + costOfBusiness.toFixed(2);
        // Table generation (omitted for brevity; use your existing code)
      }
      // Attach event listeners for custom dropdown labels
      document.getElementById("selectedYearLabel").addEventListener("click", function() {
        document.getElementById("yearDropdownMenu").classList.toggle("open");
      });
      document.getElementById("selectedSetLabel").addEventListener("click", function() {
        document.getElementById("setDropdownMenu").classList.toggle("open");
      });
      document.getElementById("priceSettingsButton").addEventListener("click", function(e) {
        e.preventDefault();
        document.getElementById("priceSettingsDuplicate").classList.toggle("open-menu");
      });
      // Additional event listeners for markup, discount, tax, supplies (as in previous version)
      document.getElementById("markupDup").addEventListener("input", function() {
        document.getElementById("markup").value = this.value;
        calculateProfit();
      });
      document.getElementById("markup").addEventListener("input", function() {
        document.getElementById("markupDup").value = this.value;
      });
      document.getElementById("markupToggleDup").addEventListener("change", function() {
        document.getElementById("markupToggle").checked = this.checked;
        updateMarkupToggleLabel();
        calculateProfit();
      });
      document.getElementById("markupToggle").addEventListener("change", function() {
        document.getElementById("markupToggleDup").checked = this.checked;
        updateMarkupToggleLabel();
        calculateProfit();
      });
      function updateMarkupToggleLabel() {
        const isDollar = document.getElementById("markupToggle").checked;
        document.getElementById("markupToggleLabel").textContent = isDollar ? "$" : "%";
        document.getElementById("markupToggleLabelDup").textContent = isDollar ? "$" : "%";
      }
      document.getElementById("userDiscountDup").addEventListener("input", function() {
        document.getElementById("userDiscount").value = this.value;
        calculateProfit();
      });
      document.getElementById("userDiscount").addEventListener("input", function() {
        document.getElementById("userDiscountDup").value = this.value;
      });
      document.getElementById("blendedTaxDup").addEventListener("input", function() {
        document.getElementById("blendedTax").value = this.value;
        calculateProfit();
      });
      document.getElementById("blendedTax").addEventListener("input", function() {
        document.getElementById("blendedTaxDup").value = this.value;
      });
      document.getElementById("suppliesDup").addEventListener("input", function() {
        document.getElementById("supplies").value = this.value;
        calculateProfit();
      });
      document.getElementById("supplies").addEventListener("input", function() {
        document.getElementById("suppliesDup").value = this.value;
      });
      // On load: fetch config.json and initialize
      window.addEventListener("load", function() {
        fetch("config.json")
          .then(response => response.json())
          .then(data => {
            setData = data.sets;
            keyPlayersData = data.keyPlayers || [];
            populateYearSelector();
          })
          .catch(error => console.error("Error loading config:", error));
      });
    </script>
  </body>
</html>
